DocRaptor PDF Integration for New Widget
Based on the current DMP system, here's the complete implementation guide for adding PDF generation to your new savings calculator widget:

Complete DocRaptor Implementation Guide
1. Environment Setup
Add the DocRaptor API key to your environment:

DOCRAPTOR_API_KEY=your_docraptor_key_here
2. Backend Implementation
API Route (Express.js)
// POST /api/generate-savings-report
app.post('/api/generate-savings-report', async (req, res) => {
  try {
    const calculatorData = req.body;
    
    // Generate PDF using DocRaptor
    const pdfBuffer = await generateSavingsReportPDF(calculatorData);
    
    // Send PDF as download
    res.setHeader('Content-Type', 'application/pdf');
    res.setHeader('Content-Disposition', 'attachment; filename="DMP-Savings-Report.pdf"');
    res.send(pdfBuffer);
  } catch (error) {
    console.error('PDF generation failed:', error);
    res.status(500).json({ error: 'Failed to generate PDF' });
  }
});
PDF Generation Service
async function generateSavingsReportPDF(data) {
  const apiKey = process.env.DOCRAPTOR_API_KEY;
  if (!apiKey) {
    throw new Error('DOCRAPTOR_API_KEY not configured');
  }
  const htmlContent = generateSavingsReportHTML(data);
  
  const docConfig = {
    document_type: 'pdf',
    document_content: htmlContent,
    name: 'DMP-Savings-Report.pdf',
    test: false, // Production mode
    prince_options: {
      media: 'print',
      pdf_profile: '1.7',
      pdf_title: 'DMP Dual Pricing Savings Report',
      pdf_author: 'Dynamic Merchant Processing',
      jpeg_quality: 100,
      png_quality: 100
    }
  };
  const response = await fetch('https://api.docraptor.com/docs', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Basic ${Buffer.from(apiKey + ':').toString('base64')}`
    },
    body: JSON.stringify({ doc: docConfig })
  });
  if (!response.ok) {
    const error = await response.text();
    throw new Error(`DocRaptor API error: ${response.status} - ${error}`);
  }
  return Buffer.from(await response.arrayBuffer());
}
HTML Template Generator
function generateSavingsReportHTML(data) {
  const {
    monthlyVolume,
    currentRate,
    interchangeCost,
    flatRate,
    taxRate,
    tipRate,
    priceDifferential,
    baseVolume,
    adjustedVolume,
    processingFees,
    markupCollected,
    currentCost,
    newCost,
    monthlySavings,
    annualSavings,
    dmpProfit
  } = data;
  return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DMP Dual Pricing Savings Report</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', sans-serif;
            font-size: 11pt;
            line-height: 1.4;
            color: #1f2937;
            background: white;
        }
        
        .container {
            width: 7.5in;
            margin: 0 auto;
            padding: 0.5in;
        }
        
        .header {
            background: linear-gradient(135deg, #004ED3 0%, #0066FF 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 24pt;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            font-size: 12pt;
            opacity: 0.9;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .summary-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        
        .summary-card h3 {
            font-size: 10pt;
            color: #6b7280;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            letter-spacing: 0.5px;
        }
        
        .summary-card .value {
            font-size: 18pt;
            font-weight: 700;
            color: #004ED3;
        }
        
        .savings-positive { color: #059669; }
        .savings-negative { color: #dc2626; }
        
        .section {
            margin-bottom: 2rem;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .section h2 {
            font-size: 14pt;
            color: #1f2937;
            margin-bottom: 1rem;
            border-bottom: 2px solid #004ED3;
            padding-bottom: 0.5rem;
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .data-row:last-child {
            border-bottom: none;
        }
        
        .data-label {
            color: #6b7280;
            font-weight: 500;
        }
        
        .data-value {
            font-weight: 600;
            color: #1f2937;
        }
        
        .footer {
            margin-top: 2rem;
            text-align: center;
            color: #6b7280;
            font-size: 9pt;
        }
        
        @media print {
            .container { width: 100%; margin: 0; padding: 0.25in; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>DMP Dual Pricing Savings Calculator</h1>
            <p>Your Potential Monthly Savings Analysis</p>
        </div>
        
        <!-- Executive Summary -->
        <div class="summary-grid">
            <div class="summary-card">
                <h3>Current Cost</h3>
                <div class="value">$${currentCost.toFixed(2)}</div>
            </div>
            <div class="summary-card">
                <h3>New Cost</h3>
                <div class="value ${newCost >= 0 ? 'savings-negative' : 'savings-positive'}">
                    $${Math.abs(newCost).toFixed(2)}${newCost < 0 ? ' Credit' : ''}
                </div>
            </div>
            <div class="summary-card">
                <h3>Monthly Savings</h3>
                <div class="value savings-positive">$${monthlySavings.toFixed(2)}</div>
            </div>
        </div>
        
        <!-- Input Parameters -->
        <div class="section">
            <h2>Merchant Information</h2>
            <div class="data-grid">
                <div class="data-row">
                    <span class="data-label">Monthly Credit Card Volume</span>
                    <span class="data-value">$${monthlyVolume.toLocaleString()}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Current Processing Rate</span>
                    <span class="data-value">${currentRate}%</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Interchange Cost</span>
                    <span class="data-value">${interchangeCost}%</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Flat Rate Processing</span>
                    <span class="data-value">${flatRate}%</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Tax Rate</span>
                    <span class="data-value">${taxRate}%</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Tip Rate</span>
                    <span class="data-value">${tipRate}%</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Price Differential</span>
                    <span class="data-value">${priceDifferential}%</span>
                </div>
            </div>
        </div>
        
        <!-- Volume Breakdown -->
        <div class="section">
            <h2>Live Volume Breakdown</h2>
            <div class="data-grid">
                <div class="data-row">
                    <span class="data-label">Base Volume</span>
                    <span class="data-value">$${baseVolume.toLocaleString()}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Adjusted Card Volume</span>
                    <span class="data-value">$${adjustedVolume.toLocaleString()}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Total Processing Fees Charged</span>
                    <span class="data-value">$${processingFees.toFixed(2)}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Card Price Increase Collected</span>
                    <span class="data-value">$${markupCollected.toFixed(2)}</span>
                </div>
            </div>
        </div>
        
        <!-- Savings Analysis -->
        <div class="section">
            <h2>Savings Analysis</h2>
            <div class="data-grid">
                <div class="data-row">
                    <span class="data-label">Current Processing Cost</span>
                    <span class="data-value">$${currentCost.toFixed(2)}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">New Processing Cost</span>
                    <span class="data-value ${newCost >= 0 ? 'savings-negative' : 'savings-positive'}">
                        $${Math.abs(newCost).toFixed(2)}${newCost < 0 ? ' Credit' : ''}
                    </span>
                </div>
                <div class="data-row">
                    <span class="data-label">Monthly Savings</span>
                    <span class="data-value savings-positive">$${monthlySavings.toFixed(2)}</span>
                </div>
                <div class="data-row">
                    <span class="data-label">Annual Impact</span>
                    <span class="data-value savings-positive">$${annualSavings.toFixed(2)}</span>
                </div>
            </div>
        </div>
        
        ${dmpProfit ? `
        <!-- DMP Profitability -->
        <div class="section">
            <h2>DMP Monthly Profitability</h2>
            <div class="data-row">
                <span class="data-label">DMP Monthly Profit</span>
                <span class="data-value">$${dmpProfit.toFixed(2)}</span>
            </div>
        </div>
        ` : ''}
        
        <!-- Footer -->
        <div class="footer">
            <p>Generated on ${new Date().toLocaleDateString()} by Dynamic Merchant Processing</p>
            <p>This report is based on the provided merchant data and DMP's dual pricing model.</p>
        </div>
    </div>
</body>
</html>`;
}
3. Frontend Implementation
Update Button Handler
Replace the existing "Generate Savings Report" button with:

const handleGeneratePDF = async () => {
  try {
    setIsGenerating(true);
    
    const reportData = {
      monthlyVolume: Number(monthlyVolume),
      currentRate: Number(currentRate),
      interchangeCost: Number(interchangeCost),
      flatRate: Number(flatRate),
      taxRate: Number(taxRate),
      tipRate: Number(tipRate),
      priceDifferential: Number(priceDifferential),
      baseVolume,
      adjustedVolume,
      processingFees,
      markupCollected,
      currentCost,
      newCost,
      monthlySavings,
      annualSavings,
      dmpProfit: showDMPProfit ? dmpMonthlyProfit : null
    };
    const response = await fetch('/api/generate-savings-report', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(reportData),
    });
    if (!response.ok) throw new Error('PDF generation failed');
    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'DMP-Savings-Report.pdf';
    a.click();
    window.URL.revokeObjectURL(url);
    
  } catch (error) {
    console.error('PDF generation error:', error);
    // Add toast notification for error
  } finally {
    setIsGenerating(false);
  }
};
// Button component
<Button 
  onClick={handleGeneratePDF}
  disabled={isGenerating}
  className="w-full bg-blue-600 hover:bg-blue-700"
>
  {isGenerating ? (
    <>
      <Loader2 className="w-4 h-4 mr-2 animate-spin" />
      Generating...
    </>
  ) : (
    <>
      <Download className="w-4 h-4 mr-2" />
      Generate Savings Report
    </>
  )}
</Button>
4. Key Implementation Notes
DocRaptor API: Uses the same API structure as the current DMP system
Professional Styling: Matches DMP brand colors and typography
Responsive Design: Optimized for both screen and print
Data Validation: Ensure all calculation values are properly formatted
Error Handling: Graceful fallbacks for failed PDF generation
Loading States: User feedback during PDF generation process
This implementation provides the same professional PDF quality as the existing DMP system, adapted specifically for the savings calculator widget format shown in your screenshot.