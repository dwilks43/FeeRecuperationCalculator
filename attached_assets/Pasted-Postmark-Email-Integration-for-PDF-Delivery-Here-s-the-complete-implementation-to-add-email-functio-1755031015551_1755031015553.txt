Postmark Email Integration for PDF Delivery
Here's the complete implementation to add email functionality to your widget:

1. Backend Email Service
Create an email service that integrates with your existing PDF generation:

// Email service function
async function sendSavingsReportEmail(recipientEmail, recipientName, calculatorData) {
  const postmarkToken = process.env.POSTMARK_SERVER_TOKEN;
  const verifiedSender = process.env.POSTMARK_VERIFIED_SENDER;
  
  if (!postmarkToken || !verifiedSender) {
    throw new Error('Postmark configuration missing');
  }
  // Generate PDF buffer
  const pdfBuffer = await generateSavingsReportPDF(calculatorData);
  
  // Convert PDF to base64 for attachment
  const pdfBase64 = pdfBuffer.toString('base64');
  
  const emailData = {
    From: verifiedSender,
    To: recipientEmail,
    Subject: 'Your DMP Dual Pricing Savings Report',
    HtmlBody: generateEmailHTML(recipientName, calculatorData),
    TextBody: generateEmailText(recipientName, calculatorData),
    Attachments: [{
      Name: 'DMP-Savings-Report.pdf',
      Content: pdfBase64,
      ContentType: 'application/pdf'
    }]
  };
  const response = await fetch('https://api.postmarkapp.com/email', {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json',
      'X-Postmark-Server-Token': postmarkToken
    },
    body: JSON.stringify(emailData)
  });
  if (!response.ok) {
    const error = await response.text();
    throw new Error(`Postmark API error: ${response.status} - ${error}`);
  }
  return await response.json();
}
// Email HTML template
function generateEmailHTML(recipientName, data) {
  const { monthlySavings, annualSavings, monthlyVolume } = data;
  
  return `
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #004ED3 0%, #0066FF 100%); color: white; padding: 30px; text-align: center; border-radius: 8px; }
        .content { background: #f9f9f9; padding: 30px; border-radius: 8px; margin: 20px 0; }
        .highlight { background: #e8f4fd; border-left: 4px solid #004ED3; padding: 15px; margin: 20px 0; }
        .savings { font-size: 24px; font-weight: bold; color: #059669; }
        .footer { text-align: center; color: #666; font-size: 12px; margin-top: 30px; }
        .cta { background: #004ED3; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; display: inline-block; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Your Dual Pricing Savings Report</h1>
            <p>Personalized analysis from Dynamic Merchant Processing</p>
        </div>
        
        <div class="content">
            <p>Hello ${recipientName || 'Valued Merchant'},</p>
            
            <p>Thank you for using our Dual Pricing Savings Calculator. Based on your monthly volume of <strong>$${monthlyVolume.toLocaleString()}</strong>, we've prepared a comprehensive analysis of your potential savings.</p>
            
            <div class="highlight">
                <h3>Your Potential Savings:</h3>
                <div class="savings">Monthly: $${monthlySavings.toFixed(2)}</div>
                <div class="savings">Annual: $${annualSavings.toFixed(2)}</div>
            </div>
            
            <p>Your detailed savings report is attached to this email as a PDF. This report includes:</p>
            <ul>
                <li>Complete breakdown of your current vs. new processing costs</li>
                <li>Volume analysis with dual pricing calculations</li>
                <li>Monthly and annual savings projections</li>
                <li>Professional formatting for presentations</li>
            </ul>
            
            <p>Ready to start saving? Our team is here to help you implement this solution.</p>
            
            <a href="mailto:${verifiedSender}?subject=DMP Dual Pricing Implementation" class="cta">Contact Us Today</a>
        </div>
        
        <div class="footer">
            <p>Dynamic Merchant Processing | Professional Payment Solutions</p>
            <p>This report was generated using your provided data and DMP's proven dual pricing model.</p>
        </div>
    </div>
</body>
</html>`;
}
// Email text version
function generateEmailText(recipientName, data) {
  const { monthlySavings, annualSavings, monthlyVolume } = data;
  
  return `
Hello ${recipientName || 'Valued Merchant'},
Thank you for using our Dual Pricing Savings Calculator. Based on your monthly volume of $${monthlyVolume.toLocaleString()}, we've prepared a comprehensive analysis of your potential savings.
YOUR POTENTIAL SAVINGS:
Monthly: $${monthlySavings.toFixed(2)}
Annual: $${annualSavings.toFixed(2)}
Your detailed savings report is attached to this email as a PDF. This report includes:
- Complete breakdown of your current vs. new processing costs
- Volume analysis with dual pricing calculations  
- Monthly and annual savings projections
- Professional formatting for presentations
Ready to start saving? Our team is here to help you implement this solution.
Contact us at: ${process.env.POSTMARK_VERIFIED_SENDER}
Dynamic Merchant Processing | Professional Payment Solutions
This report was generated using your provided data and DMP's proven dual pricing model.
`;
}
2. API Route
Add this route to handle email requests:

// POST /api/email-savings-report
app.post('/api/email-savings-report', async (req, res) => {
  try {
    const { email, name, calculatorData } = req.body;
    
    // Basic validation
    if (!email || !calculatorData) {
      return res.status(400).json({ error: 'Email and calculator data required' });
    }
    
    // Email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      return res.status(400).json({ error: 'Invalid email address' });
    }
    
    // Send email with PDF attachment
    const result = await sendSavingsReportEmail(email, name, calculatorData);
    
    res.json({ 
      success: true, 
      messageId: result.MessageID,
      message: 'Savings report sent successfully'
    });
    
  } catch (error) {
    console.error('Email sending failed:', error);
    res.status(500).json({ error: 'Failed to send email' });
  }
});
3. Frontend Email Form Component
Add this email dialog component:

import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';
import { Mail, Loader2 } from 'lucide-react';
import { useToast } from '@/hooks/use-toast';
const EmailReportDialog = ({ calculatorData, children }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [isSending, setIsSending] = useState(false);
  const [email, setEmail] = useState('');
  const [name, setName] = useState('');
  const { toast } = useToast();
  const handleSendEmail = async (e) => {
    e.preventDefault();
    
    if (!email) {
      toast({
        title: "Email Required",
        description: "Please enter your email address.",
        variant: "destructive",
      });
      return;
    }
    try {
      setIsSending(true);
      
      const response = await fetch('/api/email-savings-report', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: email.trim(),
          name: name.trim(),
          calculatorData
        }),
      });
      const result = await response.json();
      if (!response.ok) {
        throw new Error(result.error || 'Failed to send email');
      }
      toast({
        title: "Email Sent Successfully!",
        description: `Your savings report has been sent to ${email}`,
        variant: "default",
      });
      
      setIsOpen(false);
      setEmail('');
      setName('');
      
    } catch (error) {
      console.error('Email error:', error);
      toast({
        title: "Email Failed",
        description: error.message || "Failed to send email. Please try again.",
        variant: "destructive",
      });
    } finally {
      setIsSending(false);
    }
  };
  return (
    <Dialog open={isOpen} onOpenChange={setIsOpen}>
      <DialogTrigger asChild>
        {children}
      </DialogTrigger>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle>Email Your Savings Report</DialogTitle>
        </DialogHeader>
        <form onSubmit={handleSendEmail} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="email">Email Address *</Label>
            <Input
              id="email"
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              placeholder="your.email@company.com"
              required
            />
          </div>
          <div className="space-y-2">
            <Label htmlFor="name">Your Name (Optional)</Label>
            <Input
              id="name"
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="John Smith"
            />
          </div>
          <div className="flex gap-2">
            <Button 
              type="submit" 
              disabled={isSending}
              className="flex-1 bg-blue-600 hover:bg-blue-700"
            >
              {isSending ? (
                <>
                  <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                  Sending...
                </>
              ) : (
                <>
                  <Mail className="w-4 h-4 mr-2" />
                  Send Report
                </>
              )}
            </Button>
            <Button 
              type="button" 
              variant="outline" 
              onClick={() => setIsOpen(false)}
              disabled={isSending}
            >
              Cancel
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
};
4. Update Your Main Component
Replace the single PDF button with a button group:

// In your main calculator component
const [calculatorData, setCalculatorData] = useState(null);
// Update your calculation effect to store data
useEffect(() => {
  // ... your existing calculations ...
  
  // Store calculator data for email/PDF
  setCalculatorData({
    monthlyVolume: Number(monthlyVolume),
    currentRate: Number(currentRate),
    interchangeCost: Number(interchangeCost),
    flatRate: Number(flatRate),
    taxRate: Number(taxRate),
    tipRate: Number(tipRate),
    priceDifferential: Number(priceDifferential),
    baseVolume,
    adjustedVolume,
    processingFees,
    markupCollected,
    currentCost,
    newCost,
    monthlySavings,
    annualSavings,
    dmpProfit: showDMPProfit ? dmpMonthlyProfit : null
  });
}, [/* your existing dependencies */]);
// Replace single button with button group
<div className="grid grid-cols-2 gap-3">
  <Button 
    onClick={handleGeneratePDF}
    disabled={isGenerating}
    className="bg-blue-600 hover:bg-blue-700"
  >
    {isGenerating ? (
      <>
        <Loader2 className="w-4 h-4 mr-2 animate-spin" />
        Generating...
      </>
    ) : (
      <>
        <Download className="w-4 h-4 mr-2" />
        Download PDF
      </>
    )}
  </Button>
  
  <EmailReportDialog calculatorData={calculatorData}>
    <Button variant="outline" className="w-full">
      <Mail className="w-4 h-4 mr-2" />
      Email Report
    </Button>
  </EmailReportDialog>
</div>
5. Environment Variables
Ensure these are set in your widget's environment:

POSTMARK_SERVER_TOKEN=your_postmark_token
POSTMARK_VERIFIED_SENDER=your_verified_email@yourdomain.com
6. Usage Flow
User calculates savings
Clicks "Email Report" button
Dialog opens requesting email (and optional name)
System generates PDF and emails it as attachment
User receives professional email with PDF attached
This implementation provides a complete email delivery system that matches the professionalism of your current DMP platform while being perfectly standalone for your widget.